<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Face Swap 批量生成</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 12px; }
    .card { border: 1px solid #ddd; padding: 8px; border-radius: 8px; }
    img { width: 100%; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>Face Swap 批量生成（10 场景）</h1>
  <p>上传两张你的照片（正脸/侧脸更佳），点击生成，将替换到我预置的10张场景人物上。</p>

  <input type="file" id="source" accept="image/*"> 源脸1<br><br>
  <input type="file" id="target" accept="image/*"> 源脸2<br><br>
  <button id="go">生成 10 张</button>

  <p id="status"></p>
  <div id="gallery" class="grid"></div>

  <script>
    const API = "https://你的-vercel-域名.vercel.app/api/faceswap-batch";

    document.getElementById('go').onclick = async () => {
      const s = document.getElementById('source').files[0];
      const t = document.getElementById('target').files[0];
      const status = document.getElementById('status');
      const gallery = document.getElementById('gallery');

      if (!s || !t) { alert('请上传两张源脸照片'); return; }

      status.textContent = "正在生成 10 张，请稍候…（可能需要几十秒）";
      gallery.innerHTML = "";

      const fd = new FormData();
      fd.append("source", s);
      fd.append("target", t);

      try {
        const res = await fetch(API, { method: "POST", body: fd });
        const data = await res.json();

        if (!data.images) {
          status.textContent = "生成失败：" + (data.error || "无结果");
          return;
        }

        status.textContent = "生成完成 ✅";
        for (const it of data.images) {
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <div style="font-size:12px;color:#555;margin-bottom:6px;">${it.scene}${it.note ? " · " + it.note : ""}</div>
            <img src="data:image/png;base64,${it.b64}" />
          `;
          gallery.appendChild(card);
        }
      } catch (e) {
        status.textContent = "请求失败：" + e.message;
      }
    };
  </script>
</body>
</html>
